<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lucky Draw Spinner ‚Äî Color Wheel</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root { --fg:#e5e7eb; --muted:#94a3b8; --bg:#0a0a0a; --glass: rgba(255,255,255,.06); --border: rgba(255,255,255,.12); }
    *{ box-sizing: border-box; }
    body{ margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; color:var(--fg);
      background: radial-gradient(1000px 500px at 50% -150px, #0ea5e9 0%, #0a0a0a 40%);
      min-height:100vh;
    }
    h1{ margin:0; font-size:clamp(28px,3vw,40px); font-weight:800; letter-spacing:-.02em;}
    h2{ margin:.2rem 0 1rem; font-size:20px; }
    .wrap{ max-width:1100px; margin:0 auto; padding:32px 20px 48px;}
    .lead{ color:var(--muted); max-width:720px; }
    .grid{ display:grid; gap:18px; }
    @media (min-width:980px){ .grid{ grid-template-columns: 1fr 1fr; } }
    .card{ background:var(--glass); border:1px solid var(--border); border-radius:24px; padding:18px; backdrop-filter: blur(8px); }
    label{ font-size:12px; color:var(--muted); display:block; }
    select,input,button{ border-radius:12px; border:1px solid var(--border); background:#0f172a; color:var(--fg); padding:10px 12px; }
    input::placeholder{ color:#64748b; }
    button{ cursor:pointer; }
    .btn-ghost{ background:rgba(255,255,255,.08); border:1px solid var(--border); }
    .inputs{ display:grid; grid-template-columns:1fr; gap:10px; max-height:300px; overflow:auto; padding-right:6px;}
    @media (min-width:640px){ .inputs{ grid-template-columns:1fr 1fr; } }
    .hint{ font-size:12px; color:var(--muted); }
    .table{ width:100%; border-collapse: collapse; font-size:14px; }
    .table th,.table td{ text-align:left; padding:10px 12px; border-bottom:1px solid var(--border); }

    /* Wheel */
    .wheel-wrap{ position:relative; display:flex; align-items:center; justify-content:center; }
    #wheel{ display:block; width:min(520px,90vw); height:min(520px,90vw);
      border-radius:50%; background:#111; border:6px solid #111;
      box-shadow: 0 0 0 6px #222 inset, 0 8px 40px rgba(0,0,0,.6);
    }
    .pointer{ position:absolute; z-index:6; top:-4px; left:50%; transform:translateX(-50%);
      width:0; height:0; border-left:18px solid transparent; border-right:18px solid transparent; border-bottom:26px solid #ef4444; filter: drop-shadow(0 3px 6px rgba(0,0,0,.5));
    }
    #spinBtn{ position:absolute; z-index:7; left:50%; top:50%; transform:translate(-50%,-50%);
      width:96px; height:96px; border-radius:50%; border:3px solid #999;
      background: radial-gradient(circle at 30% 30%, #fff, #ddd); color:#111; font-weight:900; letter-spacing:.5px;
    }
    .center-name{ position:absolute; z-index:8; text-align:center; width:260px; left:50%; top:50%;
      transform: translate(-50%,-50%); font-weight:900; font-size:24px; color:#111; text-shadow: 0 1px 2px rgba(255,255,255,.7); pointer-events:none;
    }
    .confetti{ position:fixed; inset:0; pointer-events:none; overflow:hidden; }
  </style>
</head>
<body>
  <div class="wrap">
    <div style="display:flex;gap:10px;align-items:center">
      <div style="font-size:24px;color:#67e8f9">‚ú®</div>
      <h1>Lucky Draw <span style="background:linear-gradient(90deg,#22d3ee,#f472b6,#f59e0b);-webkit-background-clip:text;background-clip:text;color:transparent;">Spinner</span></h1>
    </div>
    <p class="lead">A colorful wheel with your names on each slice. Click <b>SPIN</b>‚Äîthe pin selects the winner. Winners + timestamps appear below.</p>

    <div class="grid">
      <!-- Controls -->
      <section class="card">
        <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px"><div>üë•</div><h2>Participants</h2></div>

        <div style="display:flex;gap:14px;flex-wrap:wrap;align-items:flex-end">
          <div>
            <label>How many?</label>
            <select id="countSelect">
              <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
              <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
              <option>11</option><option>12</option><option>13</option><option>14</option><option>15</option>
              <option>16</option><option>17</option><option>18</option><option>19</option><option>20</option>
            </select>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button id="pasteBtn" class="btn-ghost">üìã Paste names</button>
            <button id="clearAllBtn" class="btn-ghost">üßπ Clear all</button>
            <button id="resetBtn" class="btn-ghost">üîÑ Reset (keep names)</button>
            <button id="clearWinnersBtn" class="btn-ghost">üóëÔ∏è Clear winners</button>
            <button id="exportBtn" class="btn-ghost">‚¨áÔ∏è Export winners</button>
          </div>
        </div>

        <div id="namesGrid" class="inputs"></div>
        <p class="hint">Tip: paste a list to fill quickly.</p>
      </section>

      <!-- Wheel + winners -->
      <section class="card">
        <div style="display:flex;gap:10px;align-items:center;margin-bottom:10px"><div>üèÜ</div><h2>Spin & Winners</h2></div>

        <div class="wheel-wrap" style="margin-bottom:14px;">
          <div class="pointer"></div>
          <canvas id="wheel" width="520" height="520"></canvas>
          <div class="center-name" id="centerName">SPIN!</div>
          <button id="spinBtn" title="Spin">SPIN</button>
        </div>

        <!-- Backup button in case absolute one is hidden by a custom CSS/extension -->
        <div style="text-align:center;margin-top:8px">
          <button id="spinBtnBackup">‚ñ∂Ô∏è Spin</button>
        </div>

        <h3 style="margin:18px 0 8px 0;">üèÖ Results</h3>
        <table class="table">
          <thead><tr><th>Rank</th><th>Name</th><th>Timestamp</th></tr></thead>
          <tbody id="winnersBody"><tr id="noWinnersRow"><td colspan="3" class="hint">No winners yet.</td></tr></tbody>
        </table>
      </section>
    </div>
  </div>

  <div class="confetti" id="confetti"></div>

<script>
(function(){
  const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));
  const nowLocal = ()=> new Date().toLocaleString();
  const TWO_PI = Math.PI*2;

  // Elements
  const countSelect = document.getElementById('countSelect');
  const namesGrid = document.getElementById('namesGrid');
  const wheel = document.getElementById('wheel');
  const spinBtn = document.getElementById('spinBtn');
  const spinBtnBackup = document.getElementById('spinBtnBackup');
  const winnersBody = document.getElementById('winnersBody');
  const noWinnersRow = document.getElementById('noWinnersRow');
  const confettiEl = document.getElementById('confetti');
  const centerName = document.getElementById('centerName');

  // State
  let count = clamp(Number(localStorage.getItem('ld-count')||8),1,20);
  let names = (()=>{ try{ const v=JSON.parse(localStorage.getItem('ld-names')||'null'); if(v&&v.length===20) return v; }catch{} return Array.from({length:20},(_,i)=> i<8?`Name ${i+1}`:'' ); })();
  let winners = (()=>{ try{ return JSON.parse(localStorage.getItem('ld-winners')||'[]'); }catch{ return []; } })();
  let spinning=false, rotation=0;
  countSelect.selectedIndex = count-1;

  // UI
  function renderInputs(){
    namesGrid.innerHTML='';
    for(let i=0;i<count;i++){
      const wrap = document.createElement('div');
      const lab = document.createElement('label'); lab.textContent='#'+(i+1);
      const inp = document.createElement('input');
      inp.placeholder='Name '+(i+1); inp.value=names[i]||'';
      inp.oninput=()=>{ names[i]=inp.value; save(); drawWheel(); };
      wrap.appendChild(lab); wrap.appendChild(inp); namesGrid.appendChild(wrap);
    }
  }
  function renderWinners(){
    winnersBody.innerHTML='';
    if(winners.length===0){
      const tr=document.createElement('tr'); tr.innerHTML=`<td colspan="3" class="hint">No winners yet.</td>`;
      winnersBody.appendChild(tr);
    } else {
      winners.forEach(w=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td><strong>${w.rank}</strong></td><td>${w.name}</td><td>${w.at}</td>`;
        winnersBody.appendChild(tr);
      });
    }
  }
  function save(){
    localStorage.setItem('ld-count', String(count));
    localStorage.setItem('ld-names', JSON.stringify(names));
    localStorage.setItem('ld-winners', JSON.stringify(winners));
  }

  // Wheel
  function activeNames(){
    const base = names.slice(0, count).map(n=>n.trim()).filter(Boolean);
    const already = new Set(winners.map(w=>w.name));
    return base.filter(n=>!already.has(n));
  }
  const palette = ['#f87171','#60a5fa','#34d399','#fbbf24','#a78bfa','#fb7185','#38bdf8','#f59e0b'];
  function fitText(ctx, text, maxWidth, baseSize){
    let size = baseSize;
    do { ctx.font = `bold ${size--}px system-ui`; } while (ctx.measureText(text).width > maxWidth && size > 10);
    return size+1;
  }
  function drawWheel(){
    const list = activeNames();
    const n = Math.max(list.length, 1);
    const size = Math.min(520, Math.min(window.innerWidth*0.9, window.innerHeight*0.7));
    // ensure canvas has real pixels even if CSS sets size
    wheel.width = size * (window.devicePixelRatio || 1);
    wheel.height = size * (window.devicePixelRatio || 1);
    wheel.style.width = size+'px'; wheel.style.height = size+'px';

    const ctx = wheel.getContext('2d');
    const dpr = window.devicePixelRatio || 1;
    ctx.setTransform(dpr,0,0,dpr,0,0);

    const r = size/2, cx = r, cy = r;
    ctx.clearRect(0,0,size,size);

    // outer base
    ctx.beginPath(); ctx.arc(cx,cy,r-3,0,TWO_PI); ctx.fillStyle='#222'; ctx.fill();

    // slices
    for(let i=0;i<n;i++){
      const start = i*(TWO_PI/n), end = start + TWO_PI/n;
      ctx.beginPath(); ctx.moveTo(cx,cy); ctx.arc(cx,cy,r-10,start,end); ctx.closePath();
      ctx.fillStyle = palette[i % palette.length]; ctx.fill();

      // label
      ctx.save(); ctx.translate(cx,cy); ctx.rotate(start + (end-start)/2); ctx.textAlign='right';
      const maxTextWidth = r-34;
      const baseSize = Math.max(12, size/18 - (n>10? 6:0));
      const label = list[i] || '‚Äî';
      const fs = fitText(ctx,label,maxTextWidth,baseSize);
      ctx.font = `bold ${fs}px system-ui`;
      ctx.fillStyle = '#111'; ctx.strokeStyle='rgba(0,0,0,.15)'; ctx.lineWidth=2;
      ctx.strokeText(label, r-26, 6); ctx.fillText(label, r-26, 6);
      ctx.restore();
    }
    ctx.beginPath(); ctx.arc(cx,cy, r-10, 0, TWO_PI); ctx.lineWidth=6; ctx.strokeStyle='#111'; ctx.stroke();

    centerName.textContent = list.length ? 'SPIN!' : 'Add names';
  }

  // Confetti
  function confetti(){
    const emojis = ['üéâ','‚ú®','üéä','üí´','‚≠ê','ü•≥','üéà','üåü'];
    const items = Array.from({length:80}).map((_,i)=>({
      x: Math.random()*100, d: 4+Math.random()*4, emoji: emojis[Math.floor(Math.random()*emojis.length)], delay: Math.random()*0.2
    }));
    confettiEl.innerHTML='';
    items.forEach(b=>{
      const el=document.createElement('div');
      el.textContent=b.emoji; el.style.position='fixed'; el.style.left=b.x+'vw'; el.style.top='-40px'; el.style.fontSize='22px';
      el.style.transition=`transform ${b.d}s ease-out ${b.delay}s, opacity ${b.d}s ease-out ${b.delay}s`;
      confettiEl.appendChild(el);
      requestAnimationFrame(()=>{ el.style.transform='translateY(110vh) rotate(360deg)'; el.style.opacity='1'; });
      setTimeout(()=>el.remove(), (b.d+b.delay)*1000+200);
    });
  }

  // Spin
  function spin(){
    if(spinning) return;
    if(winners.length>=3){ alert('Already picked 3 winners. Clear winners or Clear all to spin again.'); return; }
    const list = activeNames();
    if(list.length===0){ alert('Enter names to spin.'); return; }

    const index = Math.floor(Math.random()*list.length);
    const n = list.length;
    const sliceDeg = 360/n;
    const targetDegFromZero = index*sliceDeg + sliceDeg/2;
    const extraTurns = 6*360;
    const targetRotation = rotation + extraTurns + (360 - targetDegFromZero);

    const start = performance.now();
    const dur = 3500 + Math.random()*1000;
    spinning = true; spinBtn.disabled=true; spinBtnBackup.disabled=true;

    function step(t){
      const p = Math.min(1,(t-start)/dur);
      const e = 1 - Math.pow(1-p,3); // easeOutCubic
      const current = rotation + (targetRotation-rotation)*e;
      wheel.style.transform = `rotate(${current}deg)`;
      if(p<1) requestAnimationFrame(step);
      else {
        rotation = targetRotation % 360;
        const winner = list[index];
        centerName.textContent = winner;
        winners.push({ rank: winners.length+1, name: winner, at: nowLocal() });
        save(); renderWinners(); confetti();
        spinning=false; spinBtn.disabled=false; spinBtnBackup.disabled=false;
        drawWheel();
      }
    }
    requestAnimationFrame(step);
  }

  // Events
  countSelect.addEventListener('change', e=>{ count = clamp(Number(e.target.value),1,20); save(); renderInputs(); drawWheel(); });
  document.getElementById('pasteBtn').addEventListener('click', ()=>{
    const text = prompt('Paste names (one per line).'); if(!text) return;
    const lines = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean).slice(0,20);
    for(let i=0;i<lines.length;i++) names[i]=lines[i];
    save(); renderInputs(); drawWheel();
  });
  document.getElementById('clearAllBtn').addEventListener('click', ()=>{
    names = Array.from({length:20},()=>''), winners=[], count=1, rotation=0;
    wheel.style.transform='rotate(0deg)'; countSelect.selectedIndex=0;
    localStorage.removeItem('ld-names'); localStorage.removeItem('ld-count'); localStorage.removeItem('ld-winners');
    centerName.textContent='SPIN!'; renderInputs(); renderWinners(); drawWheel();
  });
  document.getElementById('resetBtn').addEventListener('click', ()=>{ winners=[]; save(); renderWinners(); drawWheel(); centerName.textContent='SPIN!'; });
  document.getElementById('clearWinnersBtn').addEventListener('click', ()=>{ winners=[]; save(); renderWinners(); drawWheel(); centerName.textContent='SPIN!'; });
  document.getElementById('exportBtn').addEventListener('click', ()=>{
    const blob=new Blob([JSON.stringify({ winners },null,2)],{type:'application/json'}); const url=URL.createObjectURL(blob);
    const a=document.createElement('a'); a.href=url; a.download=`winners-${Date.now()}.json`; a.click(); URL.revokeObjectURL(url);
  });
  spinBtn.addEventListener('click', spin);
  spinBtnBackup.addEventListener('click', spin);
  window.addEventListener('resize', drawWheel);

  // Initial render
  renderInputs(); renderWinners(); drawWheel();
})();
</script>
</body>
</html>
